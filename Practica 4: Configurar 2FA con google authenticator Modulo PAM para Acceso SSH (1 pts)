# 游댳 Actualizar la lista de paquetes y el sistema
sudo apt update && sudo apt -y upgrade

# 游댳 Instalar el m칩dulo PAM de Google Authenticator
sudo apt -y install libpam-google-authenticator

# 游댳 Cambiar al usuario con el que vas a iniciar sesi칩n SSH
su - leury

# 游댳 Ejecutar el asistente para configurar Google Authenticator
#    - Escanea el c칩digo QR con la app en tu tel칠fono.
#    - Guarda la clave secreta y c칩digos de respaldo.
#    - Responde 'y' a las preguntas recomendadas.
google-authenticator

# 游댳 Editar el archivo PAM de SSH para activar Google Authenticator
#    A침ade la l칤nea: auth required pam_google_authenticator.so
sudo nano /etc/pam.d/sshd

# 游댳 Editar configuraci칩n de SSH para permitir 2FA
#    Activa ChallengeResponseAuthentication y UsePAM
sudo nano /etc/ssh/sshd_config

# Dentro de sshd_config, asegurarse que est칠n as칤:
# ChallengeResponseAuthentication yes
# PasswordAuthentication yes
# UsePAM yes
# AuthenticationMethods password,keyboard-interactive

# 游댳 Reiniciar el servicio SSH para aplicar cambios
sudo systemctl restart ssh

# 游댳 Probar el acceso SSH desde la m치quina host
#    Primero pedir치 la contrase침a del usuario.
#    Luego pedir치 el c칩digo de 6 d칤gitos de la app Google Authenticator.
ssh leury@IP_DE_TU_VM
